<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="style.css">
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
</head>

<body>
  <div id="center">
    <header>
      <div id="cover-photo">
        <div id="profile-pic">
          <img data-value="profile_picture"/>
        </div>
        <div id="name">
          <span data-value="first_name"></span>&nbsp;
          <span data-value="last_name"></span>
        </div>
      </div>
      <div id="basic-info">
        <h3 class="info"><span data-value="sex">Female</span> • <span data-value="age">21</span> • <span data-value="nationality_name">United States of America</span></h3>
        <button class="button">
          <span>Edit profile</span>
        </button>
        <button class="button hidden">
          <span class="button-icon msgicon" /></span>
          <span>Message</span>
        </button>
      </div>
    </header>
    <div id="body">
      <div class="content exp">
        <div class="experience">
          <div class="karma"><span data-value="points"></span> pts</div>
          <div class="exp-level" data-value="experience_level_category">Intermediate</div>
          <div class="exp-icons hiker"><img src="img/backpacker.svg" /></div>
        </div>
        <div class="experience">
          <div class="karma"><span data-value="karma_points"></span> pts</div>
          <div class="exp-level">Karma</div>
          <div class="exp-icons"><img src="img/karma.svg" /></div>
        </div>
      </div>
      <div class="content summary">
        <h2>Summary</h2>
        <div class="tab tab-view">
          <div class="tab-head tab-active" data-tab="lastMonth">
            4 Weeks
          </div>
          <div class="tab-head" data-tab="lastYear">
            1 Year
          </div>
          <div class="tab-head" data-tab="lifeTime">
            Lifetime
          </div>
        </div>
        <div class="tab-holder lastMonth">
          <div><span class="exp-data" data-value="hiking_stats.last_month_stats.count"></span> <span class="exp-name">HIKES</span></div>
          <div><span class="exp-data"><span data-value="hiking_stats.last_month_stats.length"></span> Km</span> <span class="exp-name">RAN</span></div>
          <div><span class="exp-data"><span data-value="hiking_stats.last_month_stats.elevation_gain"></span> m</span> <span class="exp-name">ELEVATION</span></div>
        </div>
        <div class="tab-holder lifeTime hidden">
            <div><span class="exp-data" data-value="hiking_stats.all_time_stats.count"></span> <span class="exp-name">HIKES</span></div>
            <div><span class="exp-data"><span data-value="hiking_stats.all_time_stats.length"></span> Km</span> <span class="exp-name">RAN</span></div>
            <div><span class="exp-data"><span data-value="hiking_stats.all_time_stats.elevation_gain"></span> m</span> <span class="exp-name">ELEVATION</span></div>
        </div>
        <div class="tab-holder lastYear hidden">
            <div><span class="exp-data" data-value="hiking_stats.last_year_stats.count"></span> <span class="exp-name">HIKES</span></div>
            <div><span class="exp-data"><span data-value="hiking_stats.last_year_stats.length"></span> Km</span> <span class="exp-name">RAN</span></div>
            <div><span class="exp-data"><span data-value="hiking_stats.last_year_stats.elevation_gain"></span> m</span> <span class="exp-name">ELEVATION</span></div>
        </div>
      </div>
      <div class="content charts">
        <h2>Sac scale distribution</h2>
        <ul class="chart">
          <li>
            <span title="T1"></span>
          </li>
          <li>
            <span title="T2"></span>
          </li>
          <li>
            <span title="T3"></span>
          </li>
          <li>
            <span title="T4"></span>
          </li>
          <li>
            <span title="T5"></span>
          </li>
          <li>
            <span title="T6"></span>
          </li>
        </ul>  
      </div>
      <div class="content hikes">
        <h2>Hikes</h2>
        <div class="tab tab-view">
            <div class="tab-head tab-active" data-tab="upcomingHike">
              Upcoming
            </div>
            <div class="tab-head" data-tab="recentHike">
              Recent
            </div>
            <div class="tab-head" data-tab="pastHike">
              Past
            </div>
          </div>

          <div class="tab-holder upcomingHike"></div>
          <div class="tab-holder recentHike hidden"></div>
          <div class="tab-holder pastHike hidden"></div>
      </div>
      <div class="content routes">
        <h2>Routes created</h2>
        <div id="routesHolder"></div>
      </div>
      <div class="content reviews">
        <h2>Reviews</h2>
        <div id="reviewHolder"></div>
      </div>
    </div>
  </div>
</body>
<script>
const data = {
  "upcoming_hikes": [
    {
      "date": "2024-08-17T10:00:00Z",
      "event_title": "Description template",
      "route": {
        "elevation_gain": 541,
        "distance": 6.8,
        "route_title": "Kranzhorn von Erlerberg",
        "sac_scale": "T3",
        "route_id": 261
      },
      "activity": "HI",
      "is_organizer": false,
      "event_id": 1
    },
    {
      "date": "2019-10-02T09:15:00Z",
      "activity": "SO",
      "is_organizer": true,
      "event_title": "Social meetup test",
      "event_id": 38
    }
  ],
  "first_name": "Charlie",
  "route_created_list": [
    {
      "elevation_gain": 1597,
      "distance": 20.4,
      "sac_scale": "T3",
      "id": 203,
      "route_title": "Soiernspitze"
    }
  ],
  "hikes_done": [
    {
      "date": "2018-10-21T17:45:00Z",
      "event_title": "Mittenwalder Klettersteig [16.3 Km, 1940 m gain]",
      "route": {
        "elevation_gain": 1939,
        "distance": 16.3,
        "route_title": "Mittenwalder Klettersteig",
        "sac_scale": "T4",
        "route_id": 194
      },
      "activity": "HI",
      "is_organizer": true,
      "event_id": 18
    },
    {
      "date": "2018-12-11T12:05:00Z",
      "event_title": "Hochkalter-Überschreitung mit Steinberg [4.5 Km, 199 m gain]",
      "route": {
        "elevation_gain": 199,
        "distance": 4.5,
        "route_title": "Hochkalter-Überschreitung mit Steinberg",
        "sac_scale": "T2",
        "route_id": 205
      },
      "activity": "HI",
      "is_organizer": false,
      "event_id": 22
    }
  ],
  "reviews": [
    {
      "comment": "Very good. A test review for test.",
      "reviewer_id": 1,
      "reviewer_pic": "http://52.59.231.187/media/CACHE/images/user_6/Thaneller/f1ccae5acd4f0aad76395c9753a7b147.jpg",
      "reviewer_name": "Amit Verma",
      "event_datetime": "2018-09-29T20:05:00Z",
      "rating": 5,
      "event_title": "Blomberg [9.8 Km, 627 m gain]",
      "no_show": false,
      "event_id": 11
    },
    {
      "comment": "Very friendly and fit hiker.",
      "reviewer_id": 5,
      "reviewer_pic": "http://52.59.231.187/media/CACHE/images/user_6/Thaneller/f1ccae5acd4f0aad76395c9753a7b147.jpg",
      "reviewer_name": "Charlie Harding",
      "event_datetime": "2018-09-29T20:05:00Z",
      "rating": 5,
      "event_title": "Blomberg [9.8 Km, 627 m gain]",
      "no_show": false,
      "event_id": 11
    },
    {
      "comment": "Very friendly and fit hiker. A great climber as well. It was a pleasure to meet her!",
      "reviewer_id": 1,
      "reviewer_pic": "http://52.59.231.187/media/CACHE/images/user_6/Thaneller/f1ccae5acd4f0aad76395c9753a7b147.jpg",
      "reviewer_name": "Amit Verma",
      "event_datetime": "2018-09-23T05:05:00Z",
      "rating": 5,
      "event_title": "Geigelstein [7.0 Km, 1137 m gain]",
      "no_show": false,
      "event_id": 10
    }
  ],
  "recently_completed_hikes": [
    {
      "date": "2018-08-25T15:20:00Z",
      "event_title": "Gieenbachklamm [4.5 Km, 199 m gain]",
      "route": {
        "elevation_gain": 199,
        "distance": 4.5,
        "route_title": "Hochkalter-Überschreitung mit Steinberg",
        "sac_scale": "T2",
        "route_id": 205
      },
      "activity": "HI",
      "is_organizer": false,
      "event_id": 8
    },
    {
      "date": "2019-02-20T21:15:00Z",
      "event_title": "es-us charlie",
      "route": {
        "elevation_gain": 199,
        "distance": 4.5,
        "route_title": "Hochkalter-Überschreitung mit Steinberg",
        "sac_scale": "T2",
        "route_id": 205
      },
      "activity": "HI",
      "is_organizer": true,
      "event_id": 62
    },
    {
      "date": "2019-03-08T12:05:00Z",
      "activity": "BO",
      "is_organizer": true,
      "event_title": "Bouldering",
      "event_id": 68
    },
    {
      "date": "2019-03-07T12:05:00Z",
      "activity": "SK",
      "is_organizer": true,
      "event_title": "Skiing today",
      "event_id": 69
    }
  ],
  "cover_picture": "http://52.59.231.187/media/user_6/A_Fabulous_Sunset_PdTS4gT.jpg",
  "profile_picture_thumbnail": "http://52.59.231.187/media/CACHE/images/user_6/Thaneller/f1ccae5acd4f0aad76395c9753a7b147.jpg",
  "cover_picture_thumbnail": "http://52.59.231.187/media/CACHE/images/user_6/A_Fabulous_Sunset_PdTS4gT/e695f5816d726bd2f762642b50dd198a.jpg",
  "last_name": "Test",
  "experience_level_category": "Intermediate",
  "sex": "Male",
  "nationality_name": "United states of America",
  "nationality_code": "GB",
  "points": 1415,
  "member_since": "2018-10-25T16:24:35Z",
  "age": 19,
  "karma_points": 6,
  "reviews_value": [
    [
      "5",
      "Outstanding"
    ],
    [
      "4",
      "Excellent"
    ],
    [
      "3",
      "Good"
    ],
    [
      "2",
      "Poor"
    ],
    [
      "1",
      "Very disappointing"
    ]
  ],
  "id": 6,
  "upcoming_waitlisted_hikes": [],
  "hiking_stats": {
    "last_year_stats": {
      "elevation_gain": 2139,
      "length": 20.8,
      "count": 2
    },
    "sac_scale_distribution_stats": {
      "T2": 1,
      "T1": 2,
      "T3": 2,
      "T5": 1,
      "T4": 3,
      "T6": 0
    },
    "last_month_stats": {
      "elevation_gain": 0,
      "length": 0,
      "count": 0
    },
    "all_time_stats": {
      "elevation_gain": 2139,
      "length": 20.8,
      "count": 2
    }
  },
  "profile_picture": "http://52.59.231.187/media/user_6/Thaneller.jpg",
  "nationality": "None"
};

document.querySelectorAll('[data-value]').forEach(n => {
  if(n.tagName === 'IMG') {
    n.src = data[n.getAttribute('data-value')];
    return;
  }
  const target = n.getAttribute('data-value').split('.');
  let value = '';
  let obj = data;
  try {
    n.textContent = target.reduce((acc, t)=>{
      return acc[t]
    }, data);
  } catch(e) {
    n.textContent = '';
  }
});
if(data['cover_picture']) {
  document.getElementById('cover-photo').style.backgroundImage = `url(${data['cover_picture']})`;
}

// set tabs
document.querySelectorAll('.tab-view').forEach(p => p.addEventListener('click', e => {
  const parent = e.target.parentNode.parentNode;
  parent.querySelectorAll('.tab-holder').forEach(n => n.classList.add('hidden'));
  parent.querySelector(`.${e.target.getAttribute('data-tab')}`).classList.remove('hidden');
  parent.querySelectorAll('.tab-head').forEach(n => n.classList.remove('tab-active'));
  e.target.classList.add('tab-active');
}));

// set reviews
const reviewMap = {
  1: 'Very disappointing',
  2: 'Poor',
  3: 'Good',
  4: 'Excellent',
  5: 'Outstanding',
}
if (data.reviews.length > 0) {
  const reviewHolder = document.getElementById('reviewHolder');
  data.reviews.forEach(r => {
    const review = document.createElement('div');
    review.classList.add('review');
    const eventDate = new Date(r.event_datetime);
    review.innerHTML = `
      <div class="review-deets">
        <div class="img-icon"><img src="${r.reviewer_pic}" /></div>
        <div class="reviewer-name">${r.reviewer_name}</div>
        <div class="review-date">${eventDate.toLocaleDateString()}</div>
      </div>
      <div class="review-content">
        ${r.no_show ? '<h3 class="outstanding">No Show</h3>' : `<h3 class="outstanding">${reviewMap[r.rating]}</h3>`}
        <div class="review-content subtitle">${r.event_title}</div>
        <div class="review-body">${r.comment}</div>
      </div>`;
    reviewHolder.appendChild(review);
  })
}

// set Hikes
const setHikes = (info, holder) => {
  info.forEach(h => {
    if(!h.route) return;
    const hike = document.createElement('div');
    hike.classList.add('hike');
    const eventDate = new Date(h.date);
    hike.innerHTML = `
      <div class="route-date">${eventDate.toLocaleDateString()}</div>
      <div class="route-details">
        <h4>${h.event_title}</h4>
        <span class="subtitle">${h.route.route_title}<br/>${h.route.sac_scale} | ${h.route.distance} Km | ${h.route.elevation_gain}m</span>
      </div>`;
      holder.appendChild(hike);
  })
}
if (data.upcoming_hikes.length > 0) setHikes(data.upcoming_hikes, document.querySelector('.upcomingHike'));
if (data.hikes_done.length > 0) setHikes(data.hikes_done, document.querySelector('.pastHike'));
if (data.recently_completed_hikes.length > 0) setHikes(data.recently_completed_hikes, document.querySelector('.recentHike'));

// set Routes
if (data.route_created_list.length > 0) {
  const routesHolder = document.getElementById('routesHolder');
  data.route_created_list.forEach(r => {
    const route = document.createElement('div');
    route.classList.add('route');
    route.innerHTML = `
      <div class="route-details">
        <h4>${r.route_title}</h4>
        <span class="subtitle">${r.sac_scale} | ${r.distance} Km | ${r.elevation_gain}m</span>
      </div>`;
      routesHolder.appendChild(route);
  })
}

// set chart
const chartObj = data.hiking_stats.sac_scale_distribution_stats;
const totalHikes = Object.values(chartObj).reduce((x, y) => x + y);
Object.keys(chartObj).forEach(k => {
  const ele = document.querySelector(`[title="${k}"]`);
  if (ele && chartObj[k]) {
    ele.style.height = Math.floor(chartObj[k]/totalHikes*100);
    ele.setAttribute('data-label', chartObj[k]);
  }
})

</script>
</html>